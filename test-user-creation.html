<!DOCTYPE html>
<html>
<head>
    <title>Create Test User & Test Login</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        button { padding: 10px 20px; margin: 10px 5px 0 0; }
        input { margin: 5px 0; padding: 8px; width: 250px; }
        .results { white-space: pre-wrap; font-family: monospace; background: #f5f5f5; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Test User Creation & Login Fix</h1>
    
    <div class="section">
        <h2>Step 1: Create Test User</h2>
        <input type="email" id="newEmail" placeholder="Email (e.g., test@example.com)" value="test@example.com"><br>
        <input type="password" id="newPassword" placeholder="Password (e.g., TestPass123!)" value="TestPass123!"><br>
        <input type="text" id="firstName" placeholder="First Name" value="Test"><br>
        <input type="text" id="lastName" placeholder="Last Name" value="User"><br>
        <button onclick="createUser()">Create User</button>
    </div>
    
    <div class="section">
        <h2>Step 2: Test Login</h2>
        <input type="email" id="loginEmail" placeholder="Email" value="test@example.com"><br>
        <input type="password" id="loginPassword" placeholder="Password" value="TestPass123!"><br>
        <button onclick="testLogin()">Test Login</button>
    </div>
    
    <div class="section">
        <h2>Step 3: Test Forgot Password</h2>
        <input type="email" id="forgotEmail" placeholder="Email" value="test@example.com"><br>
        <button onclick="testForgotPassword()">Get Reset Code</button>
        <br><br>
        <input type="text" id="resetCode" placeholder="Reset Code (will be shown above)"><br>
        <input type="password" id="resetNewPassword" placeholder="New Password (e.g., NewPass456!)" value="NewPass456!"><br>
        <button onclick="testResetPassword()">Reset Password</button>
    </div>
    
    <div class="results" id="results"></div>

    <script>
        const API_BASE_URL = 'http://localhost:3001/api';
        const resultsDiv = document.getElementById('results');
        
        function log(message) {
            resultsDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }
        
        async function createUser() {
            const email = document.getElementById('newEmail').value;
            const password = document.getElementById('newPassword').value;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            
            log('Creating user...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, firstName, lastName })
                });
                
                const data = await response.json();
                log(`Create user response (${response.status}): ${JSON.stringify(data, null, 2)}`);
                
                if (response.ok) {
                    log('✅ User created successfully!');
                    document.getElementById('loginEmail').value = email;
                    document.getElementById('loginPassword').value = password;
                    document.getElementById('forgotEmail').value = email;
                }
            } catch (error) {
                log(`❌ Create user error: ${error.message}`);
            }
        }
        
        async function testLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            log('Testing login...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                log(`Login response (${response.status}): ${JSON.stringify(data, null, 2)}`);
                
                if (response.ok) {
                    log('✅ Login successful!');
                } else {
                    log('❌ Login failed!');
                }
            } catch (error) {
                log(`❌ Login error: ${error.message}`);
            }
        }
        
        async function testForgotPassword() {
            const email = document.getElementById('forgotEmail').value;
            
            log('Testing forgot password...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/forgot-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                
                const data = await response.json();
                log(`Forgot password response (${response.status}): ${JSON.stringify(data, null, 2)}`);
                
                if (response.ok && data.resetCode) {
                    log(`✅ Reset code generated: ${data.resetCode}`);
                    document.getElementById('resetCode').value = data.resetCode;
                }
            } catch (error) {
                log(`❌ Forgot password error: ${error.message}`);
            }
        }
        
        async function testResetPassword() {
            const email = document.getElementById('forgotEmail').value;
            const resetCode = document.getElementById('resetCode').value;
            const newPassword = document.getElementById('resetNewPassword').value;
            
            log('Testing reset password...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/reset-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, resetCode, newPassword })
                });
                
                const data = await response.json();
                log(`Reset password response (${response.status}): ${JSON.stringify(data, null, 2)}`);
                
                if (response.ok) {
                    log('✅ Password reset successful! Try logging in with new password.');
                    document.getElementById('loginPassword').value = newPassword;
                }
            } catch (error) {
                log(`❌ Reset password error: ${error.message}`);
            }
        }
    </script>
</body>
</html>
